<!doctype html>
<html lang="en">

<head>
    <link href="https://fonts.googleapis.com/css?family=Dosis:400,700" rel="stylesheet">
    <script>
        var players = [];
        function getPlayers(){
            event.preventDefault();
            playerId = document.players.player.value;
            payload = JSON.stringify({"players":[playerId]})
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST","http://limitless-oasis-80831.herokuapp.com/steamcompare/steamuserlookup", true);
            xhttp.setRequestHeader("Content-Type","application/json");
            xhttp.onload = function(){
                playerDataRaw = JSON.parse(xhttp.responseText);
                const app = document.getElementById('root');
                row = document.createElement('div');
                row.setAttribute("class","tableBody");
                playerInfo = document.createElement('div');
                playerInfo.setAttribute("class","tableRow");
                playerImageRow = document.createElement('div');
                playerImageRow.setAttribute("class","imageRow");
                playerImage = document.createElement("img");
                app.appendChild(row)
                row.appendChild(playerImageRow);
                row.appendChild(playerInfo);
                playerImageRow.appendChild(playerImage);
                playerInfo.textContent = playerDataRaw.players[0].name;
                playerImage.setAttribute("src",playerDataRaw.players[0].avatarURI);
                playerImage.setAttribute("height", 64);
                playerImage.setAttribute("width", 64);
                players.push(playerDataRaw.players[0].steamid);
                console.log(players);
            }
            xhttp.send(payload)         
        }
        function handleClick() {
            event.preventDefault(); // disable normal form submit behavior
            payload = JSON.stringify({"players":players,"wishlist":"True"}); // Not sure on the need of .value here, it's been a while.
            const app = document.getElementById('root');
            const container = document.createElement('div');
            container.setAttribute('class', 'container');
            app.appendChild(container);
            var xhttp = new XMLHttpRequest();
            xhttp.open("POST","http://limitless-oasis-80831.herokuapp.com/steamcompare/full", true);
            xhttp.setRequestHeader("Content-Type","application/json");
            xhttp.onload = function(){
                console.log("Got Return!");
                var gameReturn = JSON.parse(xhttp.responseText);
                var gameList = gameReturn.games;
                gameReturn.games.forEach(function(game){
                    console.log(game.name);
                    var multiplayer = [];
                    const card = document.createElement('div');
                    card.setAttribute('class', 'row');
                    const h3 = document.createElement('h3');
                    container.appendChild(card);
                    imgDiv = document.createElement('div');
                    imgDiv.setAttribute('class','image-col-md-3');
                    card.appendChild(imgDiv);
                    img = document.createElement('img');
                    img.setAttribute('src',game.thumbnail);
                    img.setAttribute('alt',game.name);
                    imgDiv.appendChild(img);
                    game.users.forEach(function(user){
                        userDiv = document.createElement('div');
                        userDiv.setAttribute('class','users-col-md-5')
                        card.append(userDiv);
                        const userImg = document.createElement('img');
                        userImg.setAttribute('src',user.avatarURI);
                        userImg.setAttribute('height','66px');
                        userImg.setAttribute('width','66px');
                        userDiv.appendChild(userImg);
                    });
                    game.multi.forEach(function(multiType){
                        if (multiType == 'coop' || multiType == 'multiplayer'){
                            multiDiv = document.createElement('div');
                            multiDiv.setAttribute('class','multiplayer');
                            multiGame = document.createElement('p');
                            multiGame.textContent = multiType;
                            multiDiv.appendChild(multiGame)
                            card.appendChild(multiDiv);
                        }
                    });
                })
            }
            xhttp.send(payload)
            return false; // prevent further bubbling of event
          }
    </script>
    <style>
    #root {
  max-width: 1200px;
  margin: 0 auto;
}
.container {
  display: flex;
  flex-wrap: wrap;
}
.image-col-md-3{
    float: left;
}
.user-col-md-5{
    float: top;
    align: right;
}
.user-col-md-5:nth-child(even){
    float:bottom;
}
.row {
    display: table-row;
    border: 1px solid gray;
    height: 136px;
    width: 100%;
    width: 100vw;
    padding-bottom: 5px;
    padding-top: 5px;
}
.row {
    display: table-row;
    border: 1px solid gray;
    height: 136px;
    width: 100%;
    width: 100vw;
    padding-bottom: 5px;
    padding-top: 5px;
}
.row:nth-child(odd){
    background-color:dimgrey;
}
.multiplayer{
    float: right
}

</style>
</head>
    <body>
    
    <form name="players" onSubmit="return getPlayers()">
         Player id:
         <input type="text" name="player" />
         <input name="Submit" type="submit" value="Add Player" />
    </form>
    <form name="yourForm" onSubmit="return handleClick()">
            <input name="Submit"  type="submit" value="Compare Libraries" />
        </form>
    &nbsp;
    <div id="root"></div>
    </body>
    </html>